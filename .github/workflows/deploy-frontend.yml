name: ğŸ¨ Deploy React Frontend to cPanel

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:    # Allow manual deployment

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v3

    - name: â” Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json

    - name: ğŸ“¦ Install dependencies
      run: npm install
      working-directory: ./frontend

    - name: ğŸ—ï¸ Build React app
      run: npm run build
      working-directory: ./frontend
      env:
        CI: false
        REACT_APP_API_URL: ${{ secrets.REACT_APP_API_URL }}
        REACT_APP_APP_NAME: ${{ secrets.REACT_APP_APP_NAME }}
        REACT_APP_COMPANY_NAME: ${{ secrets.REACT_APP_COMPANY_NAME }}
        REACT_APP_ADDRESS: ${{ secrets.REACT_APP_ADDRESS }}
        REACT_APP_PHONE: ${{ secrets.REACT_APP_PHONE }}
        REACT_APP_EMAIL: ${{ secrets.REACT_APP_EMAIL }}

    - name: ğŸ“ Verify build files
      run: |
        echo "ğŸ“‚ Build directory contents:"
        ls -la frontend/build/
        echo "âœ… Build completed successfully!"

    - name: ğŸš€ Deploy to cPanel via FTP
      uses: SamKirkland/FTP-Deploy-Action@v4.3.4
      with:
        server: ${{ secrets.FTP_SERVER }}
        username: ${{ secrets.FTP_USERNAME }}
        password: ${{ secrets.FTP_PASSWORD }}
        local-dir: ./frontend/build/
        server-dir: /public_html/    # â† ADD SLASH AT START
        dangerous-clean-slate: true    # âš ï¸ This will DELETE your current under-construction page!
        exclude: |
          **/.git*
          **/.git*/**
          **/node_modules/**

    - name: âœ… Deployment Success
      run: |
        echo "ğŸ‰ Frontend successfully deployed to cPanel!"
        echo "ğŸŒ Your React app is now live at: https://azholidays.com"